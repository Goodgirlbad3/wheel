version: v1.0
name: neetoCi
global_job_config:
  setup:
    - checkout
    - neetoci-version ruby 3.1.3
    - neetoci-version node 18.12
    - cp config/database.yml.ci config/database.yml
    - bundle config path 'vendor/bundle'
    - bundle install --jobs 1
    - yarn install
  jobs:
    - name: CiChecks
      commands:
        - bundle exec ruby-audit check
        - bundle exec rubocop
        - bundle exec erblint --lint-all --format compact
        - 'curl -s -L
          "https://raw.githubusercontent.com/bigbinary/wheel/main/.semaphore/commands/run_eslint_on_modified_files.sh"
          | bash'
        - bundle exec neeto-audit
        - bundle exec rake db:create db:schema:load --trace
        - bundle exec rake incinerator:check_for_missing_models
        - bundle exec rails test
        - bundle exec rake simplecov_coverage:publish
        - bundle exec rake setup
