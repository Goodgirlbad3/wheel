version: v1.0
name: cypress
global_job_config:
  setup:
    - checkout
    - neetoci-version ruby 3.1.3
    - neetoci-version node 18.12
    - neetoci-service start postgres 13
    - neetoci-service start redis 7.0.5
    - cp config/database.yml.ci config/database.yml
    - bundle config path 'vendor/bundle'
    - cache restore
    - bundle install --jobs 1
    - yarn install
    - cache store
  jobs:
    - name: CiChecks
      commands:
        - cd cypress-tests
        - npm install --legacy-peer-deps
        - npm run cypress:run --START_URL=${START_URL} --RECORD_KEY=${RECORD_KEY}
